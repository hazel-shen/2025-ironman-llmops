#!/usr/bin/env python3
"""
Qwen2.5 訓練集生成器 v1.0 - 從 BLOOM v4 改寫
目標: 300 筆訓練資料 (75% 有答案 + 25% 無答案)
格式: Qwen2.5-Instruct 對話格式

使用方式:
    python scripts/generate_qwen_train_set.py
"""

import json
import random
from pathlib import Path

# ============================================
# 1. 有答案的問題模板 - 與 BLOOM 版本相同
# ============================================
ANSWERABLE_QUESTIONS = {
    "doc_611a2e74": {  # VPN
        "簡短": [
            "vpn 連不上",
            "vpn 連線逾時", 
            "新版 vpn 客戶端在哪",
            "家裡連 vpn 失敗",
            "sso 登入不了"
        ],
        "完整": [
            "VPN 一直顯示連線逾時怎麼辦?",
            "如何設定公司的 VPN 連線?",
            "在家工作需要什麼網路工具?",
            "新版 VPN 客戶端要去哪裡下載?",
            "Mac 電腦要怎麼設定 VPN?"
        ],
        "正式": [
            "請問公司 VPN 的設定流程為何?",
            "遠端連線的步驟是什麼?",
            "2025 年 VPN 有什麼變更?"
        ],
        "混合": [
            "SSO 登入 VPN 一直失敗",
            "VPN 一直斷線重連"
        ]
    },
    
    "doc_d8148fc3": {  # MFA
        "簡短": [
            "mfa 沒開會怎樣",
            "10月後沒 mfa",
            "雙因子驗証設定",
            "帳號登不進去是不是 mfa",
            "兩步驟驗證怎麼用"
        ],
        "完整": [
            "2025年10月後沒設定雙因子驗證會發生什麼?",
            "公司帳號的多因子驗證要怎麼設定?",
            "如果一直沒啟用 MFA 會怎樣?",
            "手機換了 MFA 要怎麼辦?",
            "推薦用哪個 authenticator app?"
        ],
        "正式": [
            "請問公司帳號的 MFA 啟用規範?",
            "多因子驗證的強制時間是什麼時候?",
            "如何綁定雙因子驗證器?"
        ],
        "混合": [
            "公司帳號突然登不進去",
            "沒有 MFA 就不能登入了嗎?"
        ]
    },
    
    "doc_30059bd8": {  # 遠端辦公
        "簡短": [
            "新人可以 wfh 嗎",
            "試用期間能遠端嗎",
            "轉正前能在家工作嗎",
            "實習期可以遠端辦公嗎",
            "probation 多久"
        ],
        "完整": [
            "剛入職可以申請居家辦公嗎?",
            "試用期可以在家工作嗎?",
            "新進員工能申請 WFH 嗎?",
            "多久之後才能在家上班?",
            "實習生可以 remote 嗎?"
        ],
        "正式": [
            "請問遠端工作的申請條件為何?",
            "試用期滿是指幾個月?",
            "probation 期間的居家辦公規定"
        ],
        "混合": [
            "轉正前可以申請遠端嗎?",
            "遠端辦公需要什麼資格?"
        ]
    },
    
    "doc_2cc7937d": {  # 密碼重設
        "簡短": [
            "密碼忘了",
            "帳號鎖住了怎麼辦",
            "重置密碼連結",
            "密碼重設頁面在哪",
            "忘記公司帳號密碼"
        ],
        "完整": [
            "公司帳號密碼忘了要去哪裡重置?",
            "忘記密碼要怎麼辦?",
            "如何重設公司帳號密碼?",
            "登入失敗太多次被鎖住怎麼辦?",
            "找不到密碼重設的頁面"
        ],
        "正式": [
            "請問密碼重設的流程為何?",
            "/id/reset 這個連結在哪?",
            "如何自助重設密碼?"
        ],
        "混合": [
            "帳號被 lock 了怎麼解?",
            "沒收到密碼重設的驗證信"
        ]
    },
    
    "doc_f7379232": {  # 郵件附件
        "簡短": [
            "附件太大寄不出去",
            "50mb 的檔案怎麼傳",
            "郵件大小限制",
            "大檔案怎麼分享",
            "email 附件超過上限"
        ],
        "完整": [
            "想寄 50MB 的簡報檔給客戶怎麼辦?",
            "郵件附件太大寄不出去要怎麼處理?",
            "檔案超過 35MB 要怎麼傳?",
            "影片檔案要怎麼傳給同事?",
            "公司雲端連結要怎麼分享?"
        ],
        "正式": [
            "請問郵件附件的大小限制規定?",
            "超過限制的檔案如何處理?",
            "email 附件上限是多少?"
        ],
        "混合": [
            "傳送失敗顯示 size too large",
            "無法寄送大型檔案"
        ]
    },
    
    "doc_838f69ae": {  # 報銷
        "簡短": [
            "發票過期還能報嗎",
            "出差報帳期限",
            "報銷超過一個月",
            "發票遺失怎麼辦",
            "30天內要上傳發票"
        ],
        "完整": [
            "出差發票超過一個月還能報帳嗎?",
            "發票弄丟了還能報銷嗎?",
            "報銷的期限是幾天?",
            "逾期報帳要怎麼處理?",
            "主管不簽核報銷怎麼辦?"
        ],
        "正式": [
            "請問出差報銷的規定是什麼?",
            "差旅費用如何核銷?",
            "30 天是指工作天還是自然天?"
        ],
        "混合": [
            "發票上傳系統在哪裡?",
            "出差費用申請流程"
        ]
    },
    
    "doc_37f6edeb": {  # 差旅等級
        "簡短": [
            "出差可以坐商務艙嗎",
            "高鐵標準車廂",
            "國外出差坐經濟艙",
            "升等要誰批",
            "差旅艙等規定"
        ],
        "完整": [
            "國內出差可以坐商務車廂嗎?",
            "出差可以搭高鐵商務艙嗎?",
            "國外出差的機票等級是什麼?",
            "經濟艙可以改成商務艙嗎?",
            "國際航班可以坐商務艙嗎?"
        ],
        "正式": [
            "請問公司的差旅標準是什麼?",
            "國內出差交通工具規定",
            "升等需要誰核准?"
        ],
        "混合": [
            "訂商務艙需要副總同意嗎?",
            "標準車廂是指什麼?"
        ]
    },
    
    "doc_c7a8eb99": {  # 資安回報
        "簡短": [
            "收到奇怪的信",
            "釣魚郵件怎麼處理",
            "疑似詐騙要回報嗎",
            "資安事件通報",
            "可疑信件要轉寄給誰"
        ],
        "完整": [
            "收到奇怪的郵件要跟誰說?",
            "收到可疑郵件要怎麼處理?",
            "疑似詐騙信要通報嗎?",
            "可疑連結要不要點開?",
            "怎麼轉寄釣魚郵件?"
        ],
        "正式": [
            "請問資安事件如何通報?",
            "釣魚信件的回報管道為何?",
            "資安問題向誰回報?"
        ],
        "混合": [
            "soc@company.com 是什麼信箱?",
            "Slack #security 頻道在哪?"
        ]
    },
    
    "doc_4941edf7": {  # MDM
        "簡短": [
            "新人筆電要設定什麼",
            "mdm 註冊",
            "磁碟加密怎麼開",
            "7天內要完成什麼",
            "電腦初始設定"
        ],
        "完整": [
            "剛到職的筆電要設定什麼?",
            "新人電腦要裝哪些軟體?",
            "磁碟加密要怎麼開啟?",
            "入職 7 天內要完成什麼設定?",
            "Mac 的 FileVault 如何開啟?"
        ],
        "正式": [
            "請問裝置管理要如何註冊?",
            "公司電腦的初始設定流程",
            "MDM 是什麼東西?"
        ],
        "混合": [
            "BitLocker 怎麼設定?",
            "沒註冊 MDM 會有什麼後果?"
        ]
    },
    
    "doc_e4d9d352": {  # 資料保留
        "簡短": [
            "聊天記錄保留多久",
            "客服對話會刪除嗎",
            "180天後會消失嗎",
            "log 保存期限",
            "資料會永久保存嗎"
        ],
        "完整": [
            "客服對話會保留多久?",
            "客服對話記錄會被刪除嗎?",
            "180 天後資料會自動消失嗎?",
            "系統 log 保存多久?",
            "對話紀錄是永久保存的嗎?"
        ],
        "正式": [
            "請問審計日誌的保留期限?",
            "公司的資料留存政策為何?",
            "客服聊天記錄保留規定"
        ],
        "混合": [
            "audit log 保存期限",
            "資料保存時長的規範"
        ]
    },
    
    "doc_51f8beab": {  # 請假
        "簡短": [
            "忘記請假可以補嗎",
            "事後補假",
            "臨時請假怎麼辦",
            "請假要提前嗎",
            "補登假單流程"
        ],
        "完整": [
            "昨天忘記請假今天可以補嗎?",
            "臨時有事可以事後補請假嗎?",
            "忘記提前請假怎麼辦?",
            "要怎麼請假?",
            "特休要如何申請?"
        ],
        "正式": [
            "請問事後補登假單需要什麼程序?",
            "公司的假勤規定為何?",
            "請假系統在哪裡?"
        ],
        "混合": [
            "主管不同意補登假單",
            "病假需要醫生證明嗎?"
        ]
    },
    
    "doc_2dfaeccd": {  # 會議室
        "簡短": [
            "可以訂幾間會議室",
            "會議室預約上限",
            "訂3間會議室可以嗎",
            "會議室取消",
            "最多訂幾間"
        ],
        "完整": [
            "部門會議可以同時訂兩間會議室嗎?",
            "一次可以訂幾間會議室?",
            "可以一次訂 3 間會議室嗎?",
            "訂了會議室沒用要取消嗎?",
            "如何取消已預約的會議室?"
        ],
        "正式": [
            "請問會議室預約的上限是多少?",
            "會議室使用完要做什麼?",
            "booking room 的規定"
        ],
        "混合": [
            "會議室都被訂滿了怎麼辦?",
            "會議室預約系統在哪?"
        ]
    },
    
    "doc_540013cd": {  # 檔案保存
        "簡短": [
            "檔案一定要放雲端嗎",
            "重要文件存放",
            "可以只存電腦嗎",
            "不上傳雲端",
            "專案文件儲存規定"
        ],
        "完整": [
            "開發的程式碼一定要放雲端嗎?",
            "重要文件可以只放在電腦裡嗎?",
            "專案檔案一定要存雲端嗎?",
            "本機資料需要備份嗎?",
            "不上傳到雲端會怎樣?"
        ],
        "正式": [
            "請問檔案保存的規定是什麼?",
            "重要專案文件儲存位置為何?",
            "公司雲端硬碟在哪?"
        ],
        "混合": [
            "檔案應該存放在哪裡?",
            "公司 NAS 如何使用?"
        ]
    },
    
    "doc_e761823c": {  # 加班
        "簡短": [
            "假日加班要誰批",
            "週末加班申請",
            "加班要誰核准",
            "雙重核准",
            "平日加班要申請嗎"
        ],
        "完整": [
            "六日要加班需要找誰核准?",
            "週日加班需要誰批准?",
            "假日加班如何申請?",
            "平日 OT 需要事先申請嗎?",
            "週末工作要申請嗎?"
        ],
        "正式": [
            "請問加班申請的流程為何?",
            "雙重核准是什麼意思?",
            "為什麼人資也要核准?"
        ],
        "混合": [
            "只有部門主管同意可以嗎?",
            "可以選擇補休還是加班費?"
        ]
    },
    
    "doc_2b808180": {  # 資安培訓
        "簡短": [
            "資安測驗沒通過",
            "資安訓練要考試嗎",
            "沒完成資安測驗",
            "帳號被停用",
            "每年要上資安課嗎"
        ],
        "完整": [
            "資安線上測驗如果沒通過會怎樣?",
            "每年要考幾次資安測驗?",
            "線上資安測驗在哪裡考?",
            "考試沒過可以補考嗎?",
            "資安訓練多久要上一次?"
        ],
        "正式": [
            "請問資安教育訓練是必修嗎?",
            "未完成測驗的後果為何?",
            "培訓的 deadline 是什麼時候?"
        ],
        "混合": [
            "帳號為什麼被停用?",
            "security training 一定要完成嗎?"
        ]
    }
}

# ============================================
# 2. 無答案問題 - 與 BLOOM 版本相同
# ============================================
UNANSWERABLE_QUESTIONS = [
    # 福利相關
    ("公司有提供股票選擇權嗎?", "抱歉,此資訊不在知識庫中,請向財務部門詢問。"),
    ("員工旅遊什麼時候?", "抱歉,知識庫未記載此規定,建議向人資部門確認。"),
    ("年終獎金怎麼算?", "抱歉,此資訊不在我的知識範圍內,請向人資部門詢問。"),
    ("績效考核制度?", "抱歉,知識庫未記載此規定,請洽人資部門。"),
    ("分紅配股政策?", "抱歉,此資訊不在知識庫中,請向財務部門確認。"),
    
    # 設施相關
    ("公司提供宿舍嗎?", "抱歉,知識庫中未記載此規定,建議向行政部門確認。"),
    ("停車位怎麼申請?", "抱歉,知識庫未記載,建議向行政部門詢問。"),
    ("員工可以在辦公室養寵物嗎?", "抱歉,知識庫中未記載此規定,建議向行政部門詢問。"),
    ("健身房使用時間?", "抱歉,此資訊不在知識範圍內,請洽總務部門。"),
    ("哺乳室在哪裡?", "抱歉,知識庫未記載,建議向行政部門確認。"),
    
    # 假期相關
    ("颱風假怎麼放?", "抱歉,此資訊不在我的知識範圍內,建議向人資部門詢問。"),
    ("生日可以放假嗎?", "抱歉,知識庫中未記載此規定,請洽詢人資部門。"),
    ("婚假有幾天?", "抱歉,知識庫未記載此規定,請向人資部門確認。"),
    ("陪產假申請方式?", "抱歉,此資訊不在知識庫中,請洽人資部門。"),
    ("喪假規定?", "抱歉,知識庫未記載,建議向人資部門詢問。"),
    
    # 財務相關
    ("薪資結構包含哪些?", "抱歉,此資訊不在我的知識範圍內,請向人資部門詢問。"),
    ("調薪機制如何運作?", "抱歉,知識庫未記載此規定,請洽人資部門。"),
    ("退休金提撥比例?", "抱歉,此資訊不在知識庫中,請向財務部門確認。"),
    ("勞健保投保級距?", "抱歉,知識庫未記載,建議向人資部門詢問。"),
    
    # 組織相關
    ("公司組織架構圖?", "抱歉,此資訊不在知識範圍內,請洽人資部門。"),
    ("各部門主管是誰?", "抱歉,知識庫未記載,建議向人資部門確認。"),
    ("公司總人數?", "抱歉,此資訊不在知識庫中,請向人資部門詢問。"),
    ("換部門的流程?", "抱歉,知識庫未記載此規定,請洽人資部門。"),
    
    # 活動相關
    ("尾牙什麼時候舉辦?", "抱歉,此資訊不在知識庫中,請洽總務部門。"),
    ("團建活動如何報名?", "抱歉,知識庫未記載,建議向行政部門確認。"),
    ("運動會什麼時候?", "抱歉,此資訊不在我的知識範圍內,請洽總務部門。"),
    ("家庭日活動規劃?", "抱歉,知識庫未記載,建議向行政部門詢問。"),
    
    # 培訓相關
    ("新人訓練課程內容?", "抱歉,此資訊不在知識庫中,請向人資部門詢問。"),
    ("職涯發展計畫?", "抱歉,知識庫未記載此規定,請洽人資部門。"),
    ("外部訓練補助?", "抱歉,知識庫未記載,建議向人資部門確認。"),
    ("證照獎勵制度?", "抱歉,此資訊不在我的知識範圍內,請洽人資部門。"),
    
    # 設備相關
    ("可以自備鍵盤滑鼠嗎?", "抱歉,知識庫未記載此規定,建議向 IT 部門確認。"),
    ("雙螢幕申請流程?", "抱歉,此資訊不在知識庫中,請洽 IT 部門。"),
    ("印表機使用規定?", "抱歉,知識庫未記載,建議向總務部門詢問。"),
    ("個人手機補助?", "抱歉,此資訊不在我的知識範圍內,請洽人資部門。"),
    
    # 制度相關
    ("彈性工時制度?", "抱歉,知識庫未記載此規定,請向人資部門確認。"),
    ("輪班制度說明?", "抱歉,此資訊不在知識庫中,請洽人資部門。"),
    ("打卡規定?", "抱歉,知識庫未記載,建議向人資部門詢問。"),
    ("遲到處理方式?", "抱歉,此資訊不在我的知識範圍內,請洽人資部門。"),
    
    # 投資相關
    ("公司對於加密貨幣投資的政策?", "抱歉,目前知識庫中無相關規範,建議您向人資或法務確認。"),
    ("員工持股信託?", "抱歉,此資訊不在知識庫中,請向財務部門詢問。"),
    ("投資理財課程?", "抱歉,知識庫未記載,建議向人資部門確認。"),
    
    # 其他
    ("午餐供應時間?", "抱歉,知識庫未記載此規定,建議向總務部門詢問。"),
    ("咖啡機使用方式?", "抱歉,此資訊不在知識範圍內,請洽總務部門。"),
    ("快遞寄件流程?", "抱歉,知識庫未記載,建議向總務部門確認。"),
    ("名片印製申請?", "抱歉,此資訊不在知識庫中,請洽總務部門。"),
    ("門禁卡遺失處理?", "抱歉,知識庫未記載此規定,建議向總務部門詢問。"),
    ("訪客登記流程?", "抱歉,此資訊不在我的知識範圍內,請洽總務部門。"),
    ("辦公用品領取?", "抱歉,知識庫未記載,建議向總務部門確認。"),
    
    # 邊界案例
    ("VPN 可以在咖啡廳用嗎?", "抱歉,知識庫未記載此規定,請洽 IT 部門。"),
    ("會議室可以訂到明年嗎?", "抱歉,此資訊不在知識庫中,請洽總務部門。"),
    ("發票可以用電子發票嗎?", "抱歉,知識庫未記載此規定,請洽財務部門。"),
    ("MFA 可以用簡訊驗證嗎?", "抱歉,此資訊不在知識庫中,請洽 IT 部門。"),
    ("密碼可以跟別人一樣嗎?", "抱歉,知識庫未記載此規定,請洽資安部門。"),
    ("公司 wifi 密碼是什麼?", "抱歉,知識庫未記載,請洽 IT 部門。"),
    ("茶水間在哪裡?", "抱歉,此資訊不在知識範圍內,請洽總務部門。"),
    ("影印機怎麼用?", "抱歉,知識庫未記載,建議向總務部門詢問。"),
    ("公司通訊錄在哪?", "抱歉,此資訊不在知識庫中,請洽人資部門。"),
    ("值班表怎麼看?", "抱歉,知識庫未記載此規定,請洽人資部門。"),
    ("VPN 可以在國外用嗎?", "抱歉,知識庫未記載此規定,請洽 IT 部門。"),
    ("會議室可以外借嗎?", "抱歉,此資訊不在知識庫中,請洽總務部門。"),
    ("加班可以換補休嗎?", "抱歉,知識庫未記載此規定,請洽人資部門。"),
    ("密碼可以設定生日嗎?", "抱歉,此資訊不在知識庫中,請洽資安部門。"),
    ("報銷可以用收據嗎?", "抱歉,知識庫未記載此規定,請洽財務部門。"),
    ("特休可以賣掉嗎?", "抱歉,此資訊不在知識庫中,請向人資部門詢問。"),
    ("出差可以帶家人嗎?", "抱歉,知識庫未記載此規定,請洽人資部門。"),
    ("電腦可以玩遊戲嗎?", "抱歉,此資訊不在知識庫中,請洽 IT 部門。"),
    ("可以用私人信箱收公司信嗎?", "抱歉,知識庫未記載此規定,請洽資安部門。"),
    ("雲端空間有多大?", "抱歉,此資訊不在知識庫中,請洽 IT 部門。"),
    ("加班有上限嗎?", "抱歉,知識庫未記載此規定,請洽人資部門。"),
    ("病假有天數限制嗎?", "抱歉,此資訊不在知識庫中,請向人資部門詢問。"),
    ("會議室可以訂過夜嗎?", "抱歉,知識庫未記載此規定,請洽總務部門。"),
    ("出差可以提早出發嗎?", "抱歉,此資訊不在知識庫中,請洽人資部門。"),
    ("郵件可以自動轉寄嗎?", "抱歉,知識庫未記載此規定,請洽 IT 部門。")
]

def format_qwen_qa(question, answer):
    """
    格式化為 Qwen2.5-Instruct 對話格式
    輸入: 問題、答案
    輸出: <|im_start|>user\n問題<|im_end|>\n<|im_start|>assistant\n答案<|im_end|>
    """
    return (
        f"<|im_start|>user\n{question}<|im_end|>\n"
        f"<|im_start|>assistant\n{answer}<|im_end|>"
    )

def load_kb(filepath="data/kb.jsonl"):
    """載入知識庫"""
    kb = []
    kb_path = Path(filepath)
    
    if not kb_path.exists():
        raise FileNotFoundError(f"找不到知識庫檔案: {filepath}")
    
    with open(kb_path, 'r', encoding='utf-8') as f:
        for line in f:
            kb.append(json.loads(line))
    
    return kb

def generate_train_data(kb, total_samples=300, unanswerable_ratio=0.25):
    """生成 Qwen 格式訓練資料"""
    train_data = []
    
    # 計算各類樣本數量
    num_unanswerable = int(total_samples * unanswerable_ratio)
    num_answerable = total_samples - num_unanswerable
    
    print(f"📊 目標樣本分布:")
    print(f"   有答案問題: {num_answerable} 筆 ({(1-unanswerable_ratio)*100:.0f}%)")
    print(f"   無答案問題: {num_unanswerable} 筆 ({(unanswerable_ratio)*100:.0f}%)")
    
    # === 1. 生成有答案的問題 ===
    answerable_pool = []
    for doc in kb:
        doc_id = doc['doc_id']
        if doc_id not in ANSWERABLE_QUESTIONS:
            continue
        
        questions_by_style = ANSWERABLE_QUESTIONS[doc_id]
        answer_text = f"依據公司規範:{doc['text']}"
        
        # 合併所有風格的問題
        all_questions = []
        for style, questions in questions_by_style.items():
            all_questions.extend(questions)
        
        for q in all_questions:
            formatted = format_qwen_qa(q, answer_text)
            answerable_pool.append({"text": formatted})
    
    print(f"\n🎨 多樣性統計:")
    print(f"   問題池總量: {len(answerable_pool)} 個變體")
    print(f"   平均每個知識點: {len(answerable_pool)//len(kb):.1f} 種問法")
    
    # 隨機抽樣
    train_data.extend(random.sample(answerable_pool, min(num_answerable, len(answerable_pool))))
    
    # === 2. 生成無答案的問題 ===
    unanswerable_pool = []
    for q, a in UNANSWERABLE_QUESTIONS:
        formatted = format_qwen_qa(q, a)
        unanswerable_pool.append({"text": formatted})
    
    train_data.extend(random.sample(unanswerable_pool, min(num_unanswerable, len(unanswerable_pool))))
    
    # === 3. 隨機打亂 ===
    random.shuffle(train_data)
    
    return train_data

def save_jsonl(data, filepath):
    """儲存為 JSONL 格式"""
    output_path = Path(filepath)
    output_path.parent.mkdir(parents=True, exist_ok=True)
    
    with open(output_path, 'w', encoding='utf-8') as f:
        for item in data:
            f.write(json.dumps(item, ensure_ascii=False) + '\n')

def main():
    print("=" * 60)
    print("🎯 Qwen2.5 訓練集生成器 v1.0")
    print("=" * 60)
    
    # 設定隨機種子
    random.seed(42)
    
    # 載入知識庫
    print("\n📚 載入知識庫...")
    kb = load_kb("data/kb.jsonl")
    print(f"✅ 載入 {len(kb)} 條規範")
    
    # 生成訓練資料
    print("\n🔨 生成訓練資料...")
    train_data = generate_train_data(
        kb,
        total_samples=300,
        unanswerable_ratio=0.25
    )
    
    # 儲存
    output_file = "data/train_qwen_v1.jsonl"
    save_jsonl(train_data, output_file)
    
    print(f"\n✅ 訓練集已儲存: {output_file}")
    print(f"   總筆數: {len(train_data)}")
    
    # 統計資訊
    has_answer = sum(1 for item in train_data if "依據公司規範" in item['text'])
    no_answer = len(train_data) - has_answer
    
    print(f"\n📈 實際分布:")
    print(f"   有答案: {has_answer} 筆 ({has_answer/len(train_data)*100:.1f}%)")
    print(f"   無答案: {no_answer} 筆 ({no_answer/len(train_data)*100:.1f}%)")
    
    print(f"\n🎨 格式特點:")
    print(f"   ✅ Qwen2.5-Instruct 對話格式")
    print(f"   ✅ 使用 <|im_start|> / <|im_end|> 標記")
    print(f"   ✅ 移除 BLOOM 的 <|endoftext|> 標記")
    print(f"   ✅ 保留完整資料分布 (與 BLOOM 版本相同)")
    
    # 顯示範例
    print(f"\n📝 格式範例:")
    sample = train_data[0]['text']
    print(sample[:200] + "...")
    
    print("\n" + "=" * 60)

if __name__ == "__main__":
    main()